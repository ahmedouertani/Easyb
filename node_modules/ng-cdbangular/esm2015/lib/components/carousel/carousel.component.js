import { Component, ContentChild, ContentChildren, Input, ViewChild, ElementRef, ViewEncapsulation, Renderer2, } from '@angular/core';
import { CarouselItemComponent } from '../carousel/carousel-item/carousel-item.component';
import { CarouselInnerComponent } from '../carousel/carousel-inner/carousel-inner.component';
export class CarouselComponent {
    constructor(renderer, elRef) {
        this.renderer = renderer;
        this.elRef = elRef;
        this.activeItem = 1;
        this.interval = 6000;
        this.length = 0;
        this.mobileGesture = true;
        this.onHoverStop = true;
        this.showControls = true;
        this.showIndicators = true;
        //State variables
        this.state = {
            activeItem: this.activeItem,
            initialLength: this.length,
            srcArray: [],
            swipeAvailable: true,
            initialX: null,
            initialY: null,
        };
        this.CarouselIndicatorsArray = [];
        this.clearCycleIntervalHandler = () => clearInterval(this.cycleInterval);
        this.swipeAvailableHandler = () => (this.state.swipeAvailable = true);
        this.restartInterval = () => {
            if (!!this.interval !== false) {
                this.clearCycleIntervalHandler();
                this.cycleInterval = setInterval(this.next, this.interval);
            }
        };
        this.next = () => {
            const { activeItem, initialLength } = this.state;
            const nextIndex = activeItem + 1;
            const nextItem = nextIndex > initialLength ? 1 : nextIndex;
            this.goToIndex(nextItem);
        };
        this.prev = () => {
            const { activeItem, initialLength } = this.state;
            const prevIndex = activeItem - 1;
            const prevItem = prevIndex < 1 ? initialLength : prevIndex;
            this.goToIndex(prevItem);
        };
        this.goToIndex = (item) => {
            (this.state.activeItem = item),
                this.inner.carouselItems.toArray().forEach((component) => {
                    component.slide = true;
                    component.activeItem = this.state.activeItem;
                });
            this.restartInterval();
        };
        this.startTouch = (e) => {
            if (this.mobileGesture !== false) {
                this.state.initialX = e.touches[0].clientX;
                this.state.initialY = e.touches[0].clientY;
            }
        };
        this.moveTouch = (e) => {
            this.state.swipeAvailable = false;
            const { initialX, initialY } = this.state;
            if (initialX === null || initialY === null) {
                return;
            }
            const currentX = e.touches[0].clientX;
            const currentY = e.touches[0].clientY;
            const diffX = initialX - currentX;
            const diffY = initialY - currentY;
            if (Math.abs(diffX) > Math.abs(diffY)) {
                // sliding horizontally
                if (diffX > 0) {
                    this.next();
                }
                else {
                    this.prev();
                }
            }
            this.state.initialX = null;
            this.state.initialY = null;
        };
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.elRef.nativeElement, 'class');
        this.renderer.removeAttribute(this.elRef.nativeElement, 'style');
        let interval = this.interval;
        let oninit = () => {
            if (!!interval === false) {
                return;
            }
            this.cycleInterval = setInterval(this.next, this.interval);
            if (this.thumbnails) {
                const CarouselItemsArray = this.carouselRef.nativeElement.querySelectorAll('.carousel-item img');
                const srcArray = Array.prototype.map.call(CarouselItemsArray, (item) => item.src);
                this.state.srcArray = srcArray;
            }
            this.state.initialLength = this.length;
        };
        oninit();
        for (let i = 1; i <= this.state.initialLength; i++) {
            this.CarouselIndicatorsArray.push(i);
        }
    }
    ngAfterViewInit() {
        this.inner.carouselItems.toArray().forEach((component) => {
            setTimeout(() => {
                component.slide = true;
                component.activeItem = this.activeItem;
            }, 0);
        });
    }
    ngOnDestroy() {
        if (this.cycleInterval) {
            this.clearCycleIntervalHandler();
        }
    }
}
CarouselComponent.decorators = [
    { type: Component, args: [{
                selector: 'CDBCarousel',
                template: "<div class=\"carousel {{class}}\" [style]=\"style\" [class.carousel-thumbnails]=\"thumbnails\"\n    [class.testimonial-carousel]=\"testimonial\" [class.carousel-multi-item]=\"multiItem\"\n    [class.carousel-fade]=\"!multiItem\" aria-label='carousel' carouselRef (touchstart)=\"startTouch($event)\"\n    (touchmove)=\"state.swipeAvailable && moveTouch($event)\" (touchend)=\"onHoverStop && swipeAvailableHandler()\"\n    (mouseenter)=\"onHoverStop && clearCycleIntervalHandler()\" (mouseleave)=\"onHoverStop && restartInterval()\">\n    <div *ngIf=\"showControls && multiItem\" class=\"controls-top\">\n        <CDBCarousel-control [testimonial]='isTestimonial' [multiItem]='isMultiItem' class=\"btn-floating\"\n            direction=\"prev\" role=\"button\" (onClick)='prev()'>\n\n        </CDBCarousel-control>\n        <CDBCarousel-control [testimonial]='isTestimonial' [multiItem]='isMultiItem' class=\"btn-floating\"\n            direction=\"next\" role=\"button\" (onClick)='next()'>\n\n        </CDBCarousel-control>\n    </div>\n    <ng-content></ng-content>\n    <div *ngIf=\"showControls && !multiItem\">\n        <CDBCarousel-control [testimonial]='isTestimonial' [multiItem]='isMultiItem' direction=\"prev\" role=\"button\"\n            (onClick)='prev()'></CDBCarousel-control>\n        <CDBCarousel-control [testimonial]='isTestimonial' [multiItem]='isMultiItem' direction=\"next\" role=\"button\"\n            (onClick)='next()'></CDBCarousel-control>\n    </div>\n    <ol data-test=\"carousel-indicators\" class=\"carousel-indicators\" *ngIf=\"showIndicators\">\n        <CDBCarouselindicator *ngFor=\"let indicator of CarouselIndicatorsArray; let i = index\"\n            [img]=\"thumbnails ? state.srcArray[i] : null\" key='i' [active]=\"state.activeItem === i+1\"\n            (click)=\"goToIndex(i+1)\"></CDBCarouselindicator>\n    </ol>\n</div>",
                encapsulation: ViewEncapsulation.None,
                styles: [".carousel-inner{height:100%;overflow:hidden;position:relative;width:100%}.carousel-fade .carousel-item{display:block!important;height:100%;left:0;opacity:0;position:absolute;top:0;transition:transform 0ms ease-in-out,opacity .8s ease-out;width:100%;z-index:0}.carousel-fade .carousel-item.active{opacity:1;position:relative;z-index:1}.carousel-multi-item .carousel-item{display:inline-block!important}.carousel .carousel-slide-item{transition:left .5s}.carousel-control-next,.carousel-control-prev,.carousel-item-next,.carousel-item-prev{z-index:2}"]
            },] }
];
CarouselComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ElementRef }
];
CarouselComponent.propDecorators = {
    activeItem: [{ type: Input }],
    class: [{ type: Input }],
    style: [{ type: Input }],
    interval: [{ type: Input }],
    length: [{ type: Input }],
    mobileGesture: [{ type: Input }],
    multiItem: [{ type: Input }],
    onHoverStop: [{ type: Input }],
    showControls: [{ type: Input }],
    showIndicators: [{ type: Input }],
    slide: [{ type: Input }],
    testimonial: [{ type: Input }],
    thumbnails: [{ type: Input }],
    items: [{ type: ContentChildren, args: [CarouselItemComponent,] }],
    inner: [{ type: ContentChild, args: [CarouselInnerComponent,] }],
    carouselRef: [{ type: ViewChild, args: ['carouselRef', { static: false },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9hcHBsZS9Eb2N1bWVudHMvcHJvamVjdHMvcHJvamVjdF9kZXZ3YXJlcy9Db250cmFzdC1Cb290c3RyYXAtQW5ndWxhci9wcm9qZWN0cy9uZy1jZGJhbmd1bGFyL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Nhcm91c2VsL2Nhcm91c2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUdULFlBQVksRUFFWixlQUFlLEVBQ2YsS0FBSyxFQUNMLFNBQVMsRUFDVCxVQUFVLEVBRVYsaUJBQWlCLEVBQ2pCLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUMxRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQVE3RixNQUFNLE9BQU8saUJBQWlCO0lBbUI1QixZQUFvQixRQUFtQixFQUFVLEtBQWlCO1FBQTlDLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxVQUFLLEdBQUwsS0FBSyxDQUFZO1FBbEJ6RCxlQUFVLEdBQVcsQ0FBQyxDQUFDO1FBR3ZCLGFBQVEsR0FBVyxJQUFJLENBQUM7UUFDeEIsV0FBTSxHQUFXLENBQUMsQ0FBQztRQUNuQixrQkFBYSxHQUFZLElBQUksQ0FBQztRQUU5QixnQkFBVyxHQUFZLElBQUksQ0FBQztRQUM1QixpQkFBWSxHQUFZLElBQUksQ0FBQztRQUM3QixtQkFBYyxHQUFZLElBQUksQ0FBQztRQVd4QyxpQkFBaUI7UUFDakIsVUFBSyxHQUFHO1lBQ04sVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1lBQzNCLGFBQWEsRUFBRSxJQUFJLENBQUMsTUFBTTtZQUMxQixRQUFRLEVBQUUsRUFBRTtZQUNaLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsUUFB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QWE7Z0JBQ3ZCLHExREFBd0M7Z0JBRXhDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN0Qzs7O1lBWEMsU0FBUztZQUhULFVBQVU7Ozt5QkFnQlQsS0FBSztvQkFDTCxLQUFLO29CQUNMLEtBQUs7dUJBQ0wsS0FBSztxQkFDTCxLQUFLOzRCQUNMLEtBQUs7d0JBQ0wsS0FBSzswQkFDTCxLQUFLOzJCQUNMLEtBQUs7NkJBQ0wsS0FBSztvQkFDTCxLQUFLOzBCQUNMLEtBQUs7eUJBQ0wsS0FBSztvQkFFTCxlQUFlLFNBQUMscUJBQXFCO29CQUVyQyxZQUFZLFNBQUMsc0JBQXNCOzBCQUNuQyxTQUFTLFNBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgUXVlcnlMaXN0LFxuICBBZnRlclZpZXdJbml0LFxuICBDb250ZW50Q2hpbGQsXG4gIE9uSW5pdCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBJbnB1dCxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBPbkRlc3Ryb3ksXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBSZW5kZXJlcjIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBDYXJvdXNlbEl0ZW1Db21wb25lbnQgfSBmcm9tICcuLi9jYXJvdXNlbC9jYXJvdXNlbC1pdGVtL2Nhcm91c2VsLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IENhcm91c2VsSW5uZXJDb21wb25lbnQgfSBmcm9tICcuLi9jYXJvdXNlbC9jYXJvdXNlbC1pbm5lci9jYXJvdXNlbC1pbm5lci5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdDREJDYXJvdXNlbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jYXJvdXNlbC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2Nhcm91c2VsLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG59KVxuZXhwb3J0IGNsYXNzIENhcm91c2VsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBhY3RpdmVJdGVtOiBudW1iZXIgPSAxO1xuICBASW5wdXQoKSBjbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBzdHlsZTogc3RyaW5nO1xuICBASW5wdXQoKSBpbnRlcnZhbDogbnVtYmVyID0gNjAwMDtcbiAgQElucHV0KCkgbGVuZ3RoOiBudW1iZXIgPSAwO1xuICBASW5wdXQoKSBtb2JpbGVHZXN0dXJlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCkgbXVsdGlJdGVtOiBib29sZWFuO1xuICBASW5wdXQoKSBvbkhvdmVyU3RvcDogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHNob3dDb250cm9sczogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCgpIHNob3dJbmRpY2F0b3JzOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCkgc2xpZGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHRlc3RpbW9uaWFsOiBib29sZWFuO1xuICBASW5wdXQoKSB0aHVtYm5haWxzOiBib29sZWFuO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oQ2Fyb3VzZWxJdGVtQ29tcG9uZW50KVxuICBpdGVtczogUXVlcnlMaXN0PENhcm91c2VsSXRlbUNvbXBvbmVudD47XG4gIEBDb250ZW50Q2hpbGQoQ2Fyb3VzZWxJbm5lckNvbXBvbmVudCkgaW5uZXI6IENhcm91c2VsSW5uZXJDb21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoJ2Nhcm91c2VsUmVmJywgeyBzdGF0aWM6IGZhbHNlIH0pIGNhcm91c2VsUmVmOiBFbGVtZW50UmVmO1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWxSZWY6IEVsZW1lbnRSZWYpIHt9XG5cbiAgLy9TdGF0ZSB2YXJpYWJsZXNcbiAgc3RhdGUgPSB7XG4gICAgYWN0aXZlSXRlbTogdGhpcy5hY3RpdmVJdGVtLFxuICAgIGluaXRpYWxMZW5ndGg6IHRoaXMubGVuZ3RoLFxuICAgIHNyY0FycmF5OiBbXSxcbiAgICBzd2lwZUF2YWlsYWJsZTogdHJ1ZSxcbiAgICBpbml0aWFsWDogbnVsbCxcbiAgICBpbml0aWFsWTogbnVsbCxcbiAgfTtcblxuICBjeWNsZUludGVydmFsOiBhbnk7XG4gIENhcm91c2VsSW5kaWNhdG9yc0FycmF5ID0gW107XG4gIGlzTXVsdGlJdGVtO1xuICBpc1Rlc3RpbW9uaWFsO1xuXG4gIGNsZWFyQ3ljbGVJbnRlcnZhbEhhbmRsZXIgPSAoKSA9PiBjbGVhckludGVydmFsKHRoaXMuY3ljbGVJbnRlcnZhbCk7XG4gIHN3aXBlQXZhaWxhYmxlSGFuZGxlciA9ICgpID0+ICh0aGlzLnN0YXRlLnN3aXBlQXZhaWxhYmxlID0gdHJ1ZSk7XG4gIHJlc3RhcnRJbnRlcnZhbCA9ICgpID0+IHtcbiAgICBpZiAoISF0aGlzLmludGVydmFsICE9PSBmYWxzZSkge1xuICAgICAgdGhpcy5jbGVhckN5Y2xlSW50ZXJ2YWxIYW5kbGVyKCk7XG4gICAgICB0aGlzLmN5Y2xlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLm5leHQsIHRoaXMuaW50ZXJ2YWwpO1xuICAgIH1cbiAgfTtcblxuICBuZXh0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgYWN0aXZlSXRlbSwgaW5pdGlhbExlbmd0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBuZXh0SW5kZXggPSBhY3RpdmVJdGVtICsgMTtcbiAgICBjb25zdCBuZXh0SXRlbSA9IG5leHRJbmRleCA+IGluaXRpYWxMZW5ndGggPyAxIDogbmV4dEluZGV4O1xuICAgIHRoaXMuZ29Ub0luZGV4KG5leHRJdGVtKTtcbiAgfTtcblxuICBwcmV2ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgYWN0aXZlSXRlbSwgaW5pdGlhbExlbmd0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBwcmV2SW5kZXggPSBhY3RpdmVJdGVtIC0gMTtcbiAgICBjb25zdCBwcmV2SXRlbSA9IHByZXZJbmRleCA8IDEgPyBpbml0aWFsTGVuZ3RoIDogcHJldkluZGV4O1xuICAgIHRoaXMuZ29Ub0luZGV4KHByZXZJdGVtKTtcbiAgfTtcblxuICBnb1RvSW5kZXggPSAoaXRlbSkgPT4ge1xuICAgICh0aGlzLnN0YXRlLmFjdGl2ZUl0ZW0gPSBpdGVtKSxcbiAgICAgIHRoaXMuaW5uZXIuY2Fyb3VzZWxJdGVtcy50b0FycmF5KCkuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICAgIGNvbXBvbmVudC5zbGlkZSA9IHRydWU7XG4gICAgICAgIGNvbXBvbmVudC5hY3RpdmVJdGVtID0gdGhpcy5zdGF0ZS5hY3RpdmVJdGVtO1xuICAgICAgfSk7XG4gICAgdGhpcy5yZXN0YXJ0SW50ZXJ2YWwoKTtcbiAgfTtcblxuICBzdGFydFRvdWNoID0gKGUpID0+IHtcbiAgICBpZiAodGhpcy5tb2JpbGVHZXN0dXJlICE9PSBmYWxzZSkge1xuICAgICAgdGhpcy5zdGF0ZS5pbml0aWFsWCA9IGUudG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgdGhpcy5zdGF0ZS5pbml0aWFsWSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xuICAgIH1cbiAgfTtcblxuICBtb3ZlVG91Y2ggPSAoZSkgPT4ge1xuICAgIHRoaXMuc3RhdGUuc3dpcGVBdmFpbGFibGUgPSBmYWxzZTtcblxuICAgIGNvbnN0IHsgaW5pdGlhbFgsIGluaXRpYWxZIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgaWYgKGluaXRpYWxYID09PSBudWxsIHx8IGluaXRpYWxZID09PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudFggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICBjb25zdCBjdXJyZW50WSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xuXG4gICAgY29uc3QgZGlmZlggPSBpbml0aWFsWCAtIGN1cnJlbnRYO1xuICAgIGNvbnN0IGRpZmZZID0gaW5pdGlhbFkgLSBjdXJyZW50WTtcblxuICAgIGlmIChNYXRoLmFicyhkaWZmWCkgPiBNYXRoLmFicyhkaWZmWSkpIHtcbiAgICAgIC8vIHNsaWRpbmcgaG9yaXpvbnRhbGx5XG4gICAgICBpZiAoZGlmZlggPiAwKSB7XG4gICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wcmV2KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZS5pbml0aWFsWCA9IG51bGw7XG4gICAgdGhpcy5zdGF0ZS5pbml0aWFsWSA9IG51bGw7XG4gIH07XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LCAnY2xhc3MnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQsICdzdHlsZScpO1xuICAgIGxldCBpbnRlcnZhbCA9IHRoaXMuaW50ZXJ2YWw7XG5cbiAgICBsZXQgb25pbml0ID0gKCkgPT4ge1xuICAgICAgaWYgKCEhaW50ZXJ2YWwgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3ljbGVJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMubmV4dCwgdGhpcy5pbnRlcnZhbCk7XG4gICAgICBpZiAodGhpcy50aHVtYm5haWxzKSB7XG4gICAgICAgIGNvbnN0IENhcm91c2VsSXRlbXNBcnJheSA9IHRoaXMuY2Fyb3VzZWxSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgICcuY2Fyb3VzZWwtaXRlbSBpbWcnXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3Qgc3JjQXJyYXkgPSBBcnJheS5wcm90b3R5cGUubWFwLmNhbGwoXG4gICAgICAgICAgQ2Fyb3VzZWxJdGVtc0FycmF5LFxuICAgICAgICAgIChpdGVtKSA9PiBpdGVtLnNyY1xuICAgICAgICApO1xuICAgICAgICB0aGlzLnN0YXRlLnNyY0FycmF5ID0gc3JjQXJyYXk7XG4gICAgICB9XG4gICAgICB0aGlzLnN0YXRlLmluaXRpYWxMZW5ndGggPSB0aGlzLmxlbmd0aDtcbiAgICB9O1xuICAgIG9uaW5pdCgpO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRoaXMuc3RhdGUuaW5pdGlhbExlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLkNhcm91c2VsSW5kaWNhdG9yc0FycmF5LnB1c2goaSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5uZXIuY2Fyb3VzZWxJdGVtcy50b0FycmF5KCkuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29tcG9uZW50LnNsaWRlID0gdHJ1ZTtcbiAgICAgICAgY29tcG9uZW50LmFjdGl2ZUl0ZW0gPSB0aGlzLmFjdGl2ZUl0ZW07XG4gICAgICB9LCAwKTtcbiAgICB9KTtcbiAgfVxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5jeWNsZUludGVydmFsKSB7XG4gICAgICB0aGlzLmNsZWFyQ3ljbGVJbnRlcnZhbEhhbmRsZXIoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==